KISSY.add("mods/tool",function(e){return{filter:function(t,n){var r=e.filter(t,function(t){var r=!1;return e.each(n,function(n,i){t[i]&&(e.isString(t[i])?t[i].indexOf(n)>-1&&(r=!0):t[i]==n&&(r=!0))}),e.keys(n).length==0&&(r=!0),r});return r},removeBy:function(t,n){e.each(t,function(r,i){e.each(n,function(e,n){r[n]&&r[n]==e&&t.splice(i,1)})})}}}),KISSY.add("mods/tpl_list",function(){return'{{#each docs as doc}}<div class="span24 test-case"><pre class="test-code">{{doc.content}}</pre><div class="test-info"><label>\u77e5\u8bc6\u70b9: </label><span>{{doc.skill}}</span><label>\u96be\u6613\u7a0b\u5ea6: </label><span>{{#if doc.level == 1}}\u6613{{#elseif doc.level ==2}}\u4e2d{{#else}}\u96be{{/if}}</span><label>\u8017\u65f6: </label><span>{{doc.time}}\u5206</span><span class="test-actions"><a href="edit.html?id={{doc._id}}" class="J_Edit ks-button ks-button-primary" data-id="{{doc._id}}">\u7f16\u8f91</a>  <span class="J_Del ks-button ks-button-danger" data-id="{{doc._id}}">\u5220\u9664</span></span></div></div>{{/each}}'}),KISSY.add("mods/main",function(e,t,n,r,i,s){var o=e.DOM,u={init:function(){this.template_list=n(i),this.$listContainer=e.one("#J_TestCases"),this.$tags=e.one("#J_Tags"),this.allData=null,this.renderLists(),this.bindEvent()},bindEvent:function(){this.$listContainer.delegate("click",".J_Edit",this.editHandle,this),this.$listContainer.delegate("click",".J_Del",this.delHandle,this),this.$tags.delegate("click",".label",this.tagHandle,this)},editHandle:function(e){},tagHandle:function(t){t.halt();var n=t.currentTarget,r=o.attr(n,"data-param");r?r=e.JSON.parse(r):r={},this.$listContainer.html(""),this.showLoading(),this.filterData(r)},filterData:function(e){if(this.allData){var t=s.filter(this.allData.docs,e);this.renderList(t)}},delHandle:function(t){var n=confirm("\u786e\u5b9a\u8981\u5220\u9664?");if(!n)return;var r=this,i=t.currentTarget,u=o.parent(i,".test-case"),a=o.attr(i,"data-id");e.io({cache:!1,dataType:"json",data:{_id:a},type:"post",url:FETEST_API.delete,timeout:1e4,success:function(e){e.success?(r.delTestCase(u),a&&s.removeBy(r.allData.docs,{_id:a})):alert("\u5220\u9664\u5931\u8d25"+e.message)},error:function(){alert("error")},complete:function(){}})},delTestCase:function(t){if(!t)return;var n=e.Anim(t,{height:0},.3);n.on("complete",function(){o.remove(t)}),n.run()},renderLists:function(){this.getData()},getData:function(t){var n=this;t=t||{},e.io({cache:!1,dataType:"json",data:t,type:"get",url:FETEST_API.list,timeout:1e4,success:function(e){e.success?(n.allData=e,n.renderList(e.docs)):alert("err:"+e.message)},error:function(){alert("error")},complete:function(){}})},renderList:function(e){if(e&&e.length){var t=this.template_list.render({docs:e});this.hideLoading(),this.$listContainer.css("display","none"),this.$listContainer.html(t),this.$listContainer.fadeIn()}else this.hideLoading(),this.showNoResult()},hideLoading:function(){this.$listContainer.removeClass("loading-cases")},showLoading:function(){this.$listContainer.addClass("loading-cases")},showNoResult:function(){this.$listContainer.html("\u6ca1\u6709\u9898\u76ee")}};return u},{requires:["core","template","button","./tpl_list","./tool"]})